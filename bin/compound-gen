#!/usr/bin/env bash

die() {
	echo "$@"
	exit 1
}

LIST="$HOME/.config/compound-files"

[ -e "$LIST" ] || die "$LIST not found!"

echo "Creating compound files..."
while read -r source target; do
	source="$(eval "echo $source")"
	target="$(eval "echo $target")"
	[ -z "$target" ] && target="${source%.d}"

	echo "$source/ -> $target"
	[ -e "$source/00-main" ] || {
		echo "Skipped since no 00-main file exists"
		continue
	}

	cat "$source"/* > "$target"
done < "$LIST"
